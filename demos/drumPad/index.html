<!DOCTYPE html>
<html>
<head>
  <meta charset='utf-8'>

  <title>CanvasEventHelper - drum pad demo</title>

  <style type="text/css">
    body {
      margin-top: 1.0em;
      background-color: #fafaff;
      font-family: Helvetica, Arial, FreeSans, san-serif;
      color: #000;
    }
    #container {
      margin: 0 auto;
      width: 700px;
    }
    h1 { font-size: 3.8em; color: #000; margin-bottom: 3px; }
    h1 .small { font-size: 0.4em; }
    h1 a { text-decoration: none }
    h2 { font-size: 1.5em; color: #000; }
    h3 { text-align: center; color: #000; }
    a { color: #000; }
    .description { font-size: 1.2em; margin-bottom: 30px; margin-top: 30px; font-style: italic;}
    .download { float: right; }
    pre { background: #000; color: #fff; padding: 15px;}
    hr { border: 0; width: 80%; border-bottom: 1px solid #aaa}
    .footer { text-align:center; padding-top:30px; font-style: italic; }
	
	canvas {
		border	: 1px solid #dddddd;
		padding	: 3px;
	}
	
	.codeWrapper {
		border	: 1px solid #dddddd;				
		padding	: 3px;
		width	: 45em;
	}
	
	code {
		white-space	: pre-wrap;
	}
  </style>
  
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.5.2/jquery.min.js"></script>
        <script src="https://github.com/matt1/CanvasEventHelper/raw/master/canvasEventHelper.js"></script>
		<script>
            
			var helper;
			
			function drawCircleFunctionFactory(pColour, pX, pY, pRadius) {
				return function(pCtx) {
					pCtx.fillStyle = pColour;
					pCtx.arc(pX, pY, pRadius, 0, 2 * Math.PI, false);
				}
			}
			
			function drawRectangleFunctionFactory(pColour, pX, pY, pW, pH) {
				return function(pCtx) {
					pCtx.fillStyle = pColour;
					pCtx.rect(pX, pY, pW, pH);
				}
			}
			
			function playAudio(pAudioId) {
				var audio = document.getElementById(pAudioId);
				audio.play();
			}
						
			$(document).ready(function() {
		
				var canvas = document.getElementById("canvas");
				var ctx = canvas.getContext("2d");
			
				var drum1 = new clickableShape({
					drawFunction: drawRectangleFunctionFactory("#ff0000", 0.5, 0.5, 50, 50),
					
					clickFunction: function(){
						playAudio("audioBongo");
					},
					
					closeFunction: function() {
						ctx.fill();
					}				
				});
				
				var drum2 = new clickableShape({
					drawFunction: drawRectangleFunctionFactory("#00ff00", 55.5, 0.5, 50, 50),
					
					clickFunction: function(){
						playAudio("audioHihat");
					},
					
					closeFunction: function() {
						ctx.strokeStyle="#00ff00";
						ctx.lineWidth = 4;
						ctx.stroke()
					}				
				});
				
				var drum3 = new clickableShape({
					drawFunction: drawCircleFunctionFactory("#0000ff", 135.5, 25.5, 25),
					
					clickFunction: function(){
						playAudio("audioCowbell");
					},
					
					closeFunction: function() {
						ctx.fill();
					}				
				});

				var drum4 = new clickableShape({
					drawFunction: drawRectangleFunctionFactory("#000000", 165.5, 0.5 , 445, 50),
					
					clickFunction: function(){
						playAudio("audioDrum");
					},
					
					closeFunction: function() {						
						ctx.fill();
						ctx.fillStyle="#fff";
						ctx.font = "bold 64px sans-serif";
						ctx.fillText("Some text too.", 166.5, 49);
					}				
				});
			
				helper = new canvasEventHelper();		
				helper.context = ctx;
				helper.eventAwareShapes = [drum1,drum2,drum3, drum4];
				helper.drawShapes();
		
				
				$('#canvas').bind('click', function(event){			
					var x, y;
					x = event.pageX - $('#canvas').offset().left;
					y = event.pageY - $('#canvas').offset().top;
					helper.onClick(x,y);
				});
				
			});
			
			
        </script>
</head>

<body>
  <a href="http://github.com/matt1/CanvasEventHelper"><img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub" /></a>

  <div id="container">
    <div class="download">
      <a href="http://github.com/matt1/CanvasEventHelper/zipball/master">
        <img border="0" width="90" src="http://github.com/images/modules/download/zip.png"></a>
      <a href="http://github.com/matt1/CanvasEventHelper/tarball/master">
        <img border="0" width="90" src="http://github.com/images/modules/download/tar.png"></a>
    </div>

    <h1><a href="http://github.com/matt1/CanvasEventHelper">CanvasEventHelper</a>
      <span class="small">by <a href="http://github.com/matt1">matt1</a></span></h1>
		
		<a href="http://matt1.github.com/CanvasEventHelper/">&lt; Home</a>
		
		<h2>Simplest "onClick" Canvas Event Helper Demo</h2>
		<p>
			This demo shows possibly the simplest demo of the Canvas Event Helper in action - we draw a couple of simple shapes on the canvas then make each of them play a HTML 5 audio tag when they are clicked.  (Please note that currently browsers will not starting playing an audio tag again if it is already playing - this means that it might appear that the click hasn't been registered if you repeatedly click on the same shape - dont worry, it has been registered it is just that the browser is waiting for the current sample to finish playing before it allows it to be started agian.)
			<br/>
			<br/>
			Note how that with the blue circle, the event only fires when we click on the actual circle - we get that "for free" without hassling with any trignometry!  The text is a slight trick - we simply draw a path around the text (this time a rectangle) and check for clicks on that as HTML 5 doesn't support paths for text.
			<br/>
			<br/>
			We're using jQuery here to help with some of the boiler plate stuff like attaching event handlers to the canvas element - you could use something else (e.g. Dojo) if you really wanted.  The Canvas Event Helper itself doesn't rely on jQuery.
		</p>
        <canvas id="canvas" width="610" height="51">
			Sorry, you need support for HTML 5's canvas tag.  Try upgrading your browser.
        </canvas>
		<p>
		The awesome samples used for this are from <a href="http://www.drumsamples.org/">http://www.drumsamples.org/</a>.
		</p>
		<h2>Explanation</h2>
		<p>
			Lets look at how this works:
			<ol>
				<li>
					<p>
						Lets start by looking at how we create the first red square.  As noted before we're using jQuery in this demo to help us with some of the boring boiler plate stuff, and here we're using jQuery's <code>$(document).ready()</code> function to setup some stuff when the page loads - you could use the normal window onload instead if you wanted.
						<br /><br />
						So lets look at how we define the first square when the page loads and is ready:
					</p>
					<div class="codeWrapper">
						<code>$(document).ready(function() {
	...
	
	var drum1 = new clickableShape({
		drawFunction: drawRectangleFunctionFactory("#ff0000", 0.5, 0.5, 50, 50),
		
		clickFunction: function(){
			playAudio("audioBongo");
		},
		
		closeFunction: function() {
			ctx.fill();
		}				
	});
	
	...
});</code>
					</div>
					<p>
						What we're doing is creating a new <code>clickableShape</code> object and setting some properties on it to define how we want the object to be drawn.  Lets take a closer look at those properties.
						<ul>
							<li>
								<strong>drawFunction</strong> is the function that is used to draw the actual shape on the screen.  Here we've used a factory to take advantage of JavaScript's closure functionality to ensure that the variables we provide it here are kept in scope when its subsequently redrawn.  
								<br /><br />
								Canvas Event Helper relies on the path not being closed in order to detect clicks etc - make sure that there are not any methods that close the path (e.g. fill(), stroke(), closePath() and even fillRect()) in the drawFunction or click detection might not work as you expected it to (or at all!) for that object.
								<br /><br />
							</li>
							<li>
								<strong>clickFunction</strong> is the function that is invoked when this <code>clickableShape</code> has been clicked on.  In this case it calls off to a function to play a sound file via HTML 5's audio tag.
								<br /><br />
							</li>
							<li>
								<strong>closeFunction</strong> is the function that is used to close the path that was opened automatically before the drawFunction.  You need to tell the helper how to close the path as there could be different things to want to do - e.g. stroke() and fill() both close the path but have really different effects on the shape.
								<br /><br />
							</li>
						</ul>
					</p>
				</li>
				<li>
					<p>
						Now that we've created the first red square, we can go on to create all of the other shapes we want to handle.  I wont bother discussing those but feel free to check out the source of this page for what was done.
					</p>
				</li>
				<li>
					<p>
						Having created all of the shapes we want to handle events for, its now time to register them with the <code>canvasEventHelper</code> object once the page has finished loading
					</p>
					<div class="codeWrapper">
						<code>$(document).ready(function() {
	...	// finish defining all of our shapes as discussed above
	
	var canvas = document.getElementById("canvas");
	var ctx = canvas.getContext("2d");
	
	helper = new canvasEventHelper();		
	helper.context = ctx;
	helper.eventAwareShapes = [drum1, drum2, drum3, drum4];
	helper.drawShapes();

	...
});</code>
					</div>
					<p>
					Here we are creating a new <code>canvasEventHelper</code>, and letting it know which context its going to be working on.  After that its simply just a matter of telling it which shapes to draw (recognise drum1?  Thats the one we looked at in the steps above - the others are just more of the same).
					<br /><br />
					Finally we tell it to <code>drawShapes()</code> so that there is something on screen when the page displays to the user.
					</p>
				</li>
				<li>
					<p>
						Finally - and this is where a framework like jQuery comes in handy - we setup the canvas element's click handler to do two things:
						<ol>
							<li>First, it calculates the "canvas space" coordinates (i.e. where the mouse was in respect to the canvas's coordinate system and not the page's coordinate ssytem)</li>
							<li>Secondly, it then passes those canvas space coordinates on to the <code>canvasEventHelper</code> object</li>
						</ol>
					</p>
					<div class="codeWrapper">
						<code>$(document).ready(function() {
	...	
	
	$('#canvas').bind('click', function(event){			
		var x, y;
		x = event.pageX - $('#canvas').offset().left;
		y = event.pageY - $('#canvas').offset().top;
		helper.onClick(x,y);
	});

	...
});</code>
					</div>
					<p>
						Once the <code>canvasEventHelper</code> object's <code>onClick()</code> function has been called, it will redraw all of its objects one by one and, where one has been clicked (i.e. where the event was "over" the object we drew on the canvas), invoke its clickFunction.  Thats all it takes!
					</p>
				</li>
			</ol>			
		</p>
		
		<audio id="audioBongo">
			<source src="bongo2.ogg" />  	
			<source src="bongo2.wav" />
			Sorry, you need support for HTML 5's audio tag.  Try upgrading your browser.
		</audio>
		<audio id="audioCowbell">
			<source src="cowbell6.ogg" /> 
			<source src="cowbell6.wav" />		
		</audio>
		<audio id="audioHihat">
			<source src="hihat12.ogg" />  
			<source src="cowbell6.wav" />				
		</audio>
		<audio id="audioDrum">
			<source src="kickdrum16.ogg" />  
			<source src="kickdrum16.wav" />				
		</audio>	

  </div>

  
</body>
</html>

    </head>
    <body>
			
    </body>
</html>
